{
  "name": "Apply SpecKit",
  "type": "script",
  "command": "// === APPLY SPECIALIZATION KIT & BESTIARY LEVEL MACRO ===\n// Author: Neo Shain | For Halo Mythic Foundry campaign\n\n(async () => {\n  // ── 0) Require a token selection\n  if (!canvas.tokens.controlled.length) {\n    return ui.notifications.warn(\"Please select at least one token.\");\n  }\n\n  // ── 1) Pick your kit\n  const specKits = [\n    \"Heavy Weapons\",\"Vehicle Expert\",\"Marksman\",\"Close Quarters\",\n    \"Battlefield Medic\",\"Demolitions\",\"Technician/Comms\",\n    \"Point Man\",\"Recon/Infiltration\",\"Resource/Support\",\n    \"Duelist\",\"Command\",\"Logistics\",\"Medical Physician\"\n  ];\n  const selectedSpec = await new Promise(resolve => {\n    new Dialog({\n      title: \"Select Specialization Kit\",\n      content: \"<p>Select which Specialization Kit to apply:</p>\",\n      buttons: specKits.reduce((o, kit) => {\n        o[kit] = { label: kit, callback: () => { resolve(kit); return true; }};\n        return o;\n      }, {}),\n      default: specKits[0]\n    }).render(true);\n  });\n\n  // ── 2) Pick your Bestiary Level\n  const levels = [\"Easy\",\"Normal\",\"Heroic\",\"Legendary\"];\n  const bestiaryLevel = await new Promise(resolve => {\n    new Dialog({\n      title: \"Select Bestiary Level\",\n      content: \"<p>Select Bestiary Level to apply:</p>\",\n      buttons: levels.reduce((o, lvl) => {\n        o[lvl] = { label: lvl, callback: () => { resolve(lvl); return true; }};\n        return o;\n      }, {}),\n      default: \"Normal\"\n    }).render(true);\n  });\n\n  // ── 3) Prompt any follow-ups for variants\n  let pilotVariant, navVariant, techVariant, medVariant;\n  // a) Pilot / Nav / Tech for Vehicle Expert\n  if (selectedSpec === \"Vehicle Expert\") {\n    pilotVariant = await new Promise(resolve => {\n      new Dialog({\n        title: \"Vehicle Expert → Pilot Type\",\n        content: \"<p>Which Pilot skill?</p>\",\n        buttons: {\n          air:    { label: \"Pilot (Air)\",    callback: () => { resolve(\"Air\");    return true; } },\n          ground: { label: \"Pilot (Ground)\", callback: () => { resolve(\"Ground\"); return true; } }\n        },\n        default: \"air\"\n      }).render(true);\n    });\n    navVariant = await new Promise(resolve => {\n      new Dialog({\n        title: \"Vehicle Expert → Navigation Type\",\n        content: \"<p>Which Navigation skill?</p>\",\n        buttons: {\n          ga:    { label: \"Navigation (Ground/Air)\", callback: () => { resolve(\"Ground/Air\"); return true; } },\n          space: { label: \"Navigation (Space)\",       callback: () => { resolve(\"Space\");      return true; } }\n        },\n        default: \"ga\"\n      }).render(true);\n    });\n    techVariant = await new Promise(resolve => {\n      new Dialog({\n        title: \"Vehicle Expert → Tech Type\",\n        content: \"<p>Which Tech skill?</p>\",\n        buttons: {\n          human:      { label: \"Tech (Human)\",      callback: () => { resolve(\"Human\");      return true; } },\n          covenant:   { label: \"Tech (Covenant)\",   callback: () => { resolve(\"Covenant\");   return true; } },\n          forerunner: { label: \"Tech (Forerunner)\", callback: () => { resolve(\"Forerunner\"); return true; } }\n        },\n        default: \"human\"\n      }).render(true);\n    });\n  }\n  // b) Navigation for Marksman, Recon/Infiltration & Resource/Support\n  else if ([\"Marksman\",\"Recon/Infiltration\",\"Resource/Support\"].includes(selectedSpec)) {\n    navVariant = await new Promise(resolve => {\n      new Dialog({\n        title: `${selectedSpec} → Navigation Type`,\n        content: \"<p>Which Navigation skill?</p>\",\n        buttons: {\n          ga:    { label: \"Navigation (Ground/Air)\", callback: () => { resolve(\"Ground/Air\"); return true; } },\n          space: { label: \"Navigation (Space)\",       callback: () => { resolve(\"Space\");      return true; } }\n        },\n        default: \"ga\"\n      }).render(true);\n    });\n  }\n  // c) Tech for any kit with “Technology”\n  if ([\n    \"Vehicle Expert\",\"Battlefield Medic\",\n    \"Technician/Comms\",\"Resource/Support\",\n    \"Logistics\",\"Medical Physician\"\n  ].includes(selectedSpec)) {\n    techVariant = await new Promise(resolve => {\n      new Dialog({\n        title: `${selectedSpec} → Tech Type`,\n        content: \"<p>Which Tech skill?</p>\",\n        buttons: {\n          human:      { label: \"Tech (Human)\",      callback: () => { resolve(\"Human\");      return true; } },\n          covenant:   { label: \"Tech (Covenant)\",   callback: () => { resolve(\"Covenant\");   return true; } },\n          forerunner: { label: \"Tech (Forerunner)\", callback: () => { resolve(\"Forerunner\"); return true; } }\n        },\n        default: \"human\"\n      }).render(true);\n    });\n  }\n  // d) Med for Battlefield Medic & Medical Physician\n  if ([\"Battlefield Medic\",\"Medical Physician\"].includes(selectedSpec)) {\n    medVariant = await new Promise(resolve => {\n      new Dialog({\n        title: `${selectedSpec} → Medic Type`,\n        content: \"<p>Which Medic skill?</p>\",\n        buttons: {\n          human:      { label: \"Medic (Human)\",       callback: () => { resolve(\"Human\");      return true; } },\n          covenant:   { label: \"Medic (Covenant)\",    callback: () => { resolve(\"Covenant\");   return true; } },\n          xenophile:  { label: \"Medic (Xenophile)\",   callback: () => { resolve(\"Xenophile\"); return true; } }\n        },\n        default: \"human\"\n      }).render(true);\n    });\n  }\n  // e) Manual prompts for language & education\n  let manualLanguage, manualEducation;\n  if (selectedSpec === \"Technician/Comms\") {\n    manualLanguage = await new Promise(resolve => {\n      new Dialog({\n        title: \"Technician/Comms → Manual Step\",\n        content: \"<p>Please manually choose and train <strong>One Enemy Language</strong> on the sheet.</p>\",\n        buttons: { ok: { label: \"OK\", callback: () => resolve(true) }},\n        default: \"ok\"\n      }).render(true);\n    });\n  }\n  if ([\"Resource/Support\",\"Logistics\"].includes(selectedSpec)) {\n    manualEducation = await new Promise(resolve => {\n      new Dialog({\n        title: `${selectedSpec} → Manual Step`,\n        content: \"<p>Please manually apply <strong>Chosen Education +5</strong> on the sheet.</p>\",\n        buttons: { ok: { label: \"OK\", callback: () => resolve(true) }},\n        default: \"ok\"\n      }).render(true);\n    });\n  }\n\n  // ── 4) Your Specialization Data\n  //    Replace or tweak these arrays if you want to adjust names/items\n  const specializationData = { // the name field is the UUID, not the name, this is important! \n    \"Heavy Weapons\": {\n      \"Normal\": [\n        {type:\"item\", uuid: \"Compendium.mythic.abilities.Item.bhhFkPEsIKRckffP\"}, // Heavy Preparation\n        {type:\"item\", uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"item\", uuid: \"Compendium.mythic.abilities.Item.XssXb6JETXmsJjfP\"}, // Always Ready\n        {type:\"skill\",skill:\"Survival\",    mod:0},\n        {type:\"skill\",skill:\"Athletics\",   mod:0},\n        {type:\"skill\",skill:\"Intimidation\",mod:0}\n      ],\n      \"Heroic\": [\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.CAyM3Vmh45DelGeV\"}, // Quick Draw\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.iy2n5KwgQaCu1pcr\"}, // Under Control\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.2VNR2iaZ8GrXZ5Sx\"}, // Mind Timer\n        {type:\"skill\",skill:\"Evasion\",      mod:0},\n        {type:\"skill\",skill:\"Athletics\",    mod:10},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.uRR1tPqaF5NTlvmG\"}, // Rapid Reload\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.XomjHBejCSh4W6HT\"}, // Strong Back\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Ecxe55FHG2dPbJWq\"}, // Mobile Fire\n        {type:\"skill\",skill:\"Evasion\",      mod:10},\n        {type:\"skill\",skill:\"Survival\",     mod:10},\n        {type:\"skill\",skill:\"Intimidation\", mod:10}\n      ]\n    },\n    \"Vehicle Expert\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Ecxe55FHG2dPbJWq\"}, // Mobile Fire\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.SzbYbWPcUeP7uoLl\"}, // Eagle Eye\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"skill\",skill:\"Technology\",mod:0},\n        {type:\"skill\",skill:\"Pilot\",     mod:0},  // variant applied below\n        {type:\"skill\",skill:\"Navigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.GdTEqA4PykWSIXfI\"}, // Manslaughter\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.AsxSg8aDc8KDuaf7\"}, // Aviator\n        {type:\"skill\",skill:\"Pilot\",     mod:10},\n        {type:\"skill\",skill:\"Navigation\",mod:10},\n        {type:\"skill\",skill:\"Stunting\",  mod:0}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.WVbJDJZSIgC1uRa2\"}, // Air Time\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0pUz3WIhib9q7QPy\"}, // Resilient\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.QeSIq7XoazHnKH6o\"}, // Wheelman\n        {type:\"skill\",skill:\"Pilot\",     mod:20},\n        {type:\"skill\",skill:\"Navigation\",mod:20},\n        {type:\"skill\",skill:\"Stunting\",  mod:10}\n      ]\n    },\n    \"Marksman\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.XgrCkEcVOeVYli1k\"}, // Marksman\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.SzbYbWPcUeP7uoLl\"}, // Eagle Eye\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qdwUHz1TMAe4z5kn\"}, // Clear Target\n        {type:\"skill\",skill:\"Camouflage\",mod:0},\n        {type:\"skill\",skill:\"Athletics\", mod:0},\n        {type:\"skill\",skill:\"Navigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.uRR1tPqaF5NTlvmG\"}, // Rapid Reload\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.ZFYVOdZX28U8adJw\"}, // Snapshot\n        {type:\"skill\",skill:\"Camouflage\",mod:10},\n        {type:\"skill\",skill:\"Athletics\", mod:10},\n        {type:\"skill\",skill:\"Navigation\",mod:10}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.3KMXf1vwMEE8zufr\"}, // Triangulation\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.WFfHiWzmaJuB031m\"}, // Focused Warrior\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.7MIejljHGh3FTAgd\"}, // Break Shot\n        {type:\"skill\",skill:\"Evasion\",     mod:0},\n        {type:\"skill\",skill:\"Camouflage\",  mod:20},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ]\n    },\n    \"Close Quarters\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Frcf7nvSMFMLFyS3\"}, // Evasive Maneuvers\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JYOeQiKK2d8cBNXY\"}, // Disarm\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.c67KQTMdpyaoALat\"}, // Hand-To-Hand Basics\n        {type:\"skill\",skill:\"Survival\",    mod:0},\n        {type:\"skill\",skill:\"Athletics\",   mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.kV1ldrIUoanjfWdQ\"}, // Shotfun\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Ecxe55FHG2dPbJWq\"}, // Mobile Fire\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.k0nhPCUavrzUpjb9\"}, // Bound Back\n        {type:\"skill\",skill:\"Athletics\",   mod:10},\n        {type:\"skill\",skill:\"Investigation\",mod:10},\n        {type:\"skill\",skill:\"Evasion\",     mod:0},\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.k0nhPCUavrzUpjb9\"}, // Quick Toss\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.crNWOOlSFKXsa6n6\"}, // Disarm (Improved)\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.GVhZ5ujoVyIDV6rv\"}, // Rush\n        {type:\"skill\",skill:\"Athletics\",   mod:20},\n        {type:\"skill\",skill:\"Evasion\",     mod:10},\n        {type:\"skill\",skill:\"Survival\",    mod:10}\n      ]\n    },\n    \"Battlefield Medic\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.K8bPGrN0DTWujQDy\"}, // Cynical\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.HIWb77it2BEoVOqq\"}, // Stabilization\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.iy2n5KwgQaCu1pcr\"}, // Under Control\n        {type:\"skill\",skill:\"Investigation\",mod:0},\n        {type:\"skill\",skill:\"Medication\",   mod:0},\n        {type:\"skill\",skill:\"Technology\",   mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.XssXb6JETXmsJjfP\"}, // Always Ready\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qvUsoMk7EMuCHurE\"}, // Medical Insight\n        {type:\"skill\",skill:\"Evasion\",      mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:10},\n        {type:\"skill\",skill:\"Medication\",   mod:10}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0OOIRNcRqKw1n5HS\"}, // Blur\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Ecxe55FHG2dPbJWq\"}, // Mobile Fire\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Krt2F1WezBNvMi9Z\"}, // Medical Prowess\n        {type:\"skill\",skill:\"Evasion\",      mod:20},\n        {type:\"skill\",skill:\"Investigation\",mod:10},\n        {type:\"skill\",skill:\"Technology\",   mod:10}\n      ]\n    },\n    \"Demolitions\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.SzbYbWPcUeP7uoLl\"}, // Eagle Eye\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.iy2n5KwgQaCu1pcr\"}, // Under Control\n        {type:\"skill\",skill:\"Demolition\",  mod:0},\n        {type:\"skill\",skill:\"Athletics\",   mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.g330eWgjHS1xnFCa\"}, // Aggressive Advance\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0OOIRNcRqKw1n5HS\"}, // Blur\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.3KMXf1vwMEE8zufr\"}, // Triangulation\n        {type:\"skill\",skill:\"Demolition\",  mod:10},\n        {type:\"skill\",skill:\"Investigation\",mod:10},\n        {type:\"skill\",skill:\"Camouflage\",  mod:0}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.VF0hzdmqI0NUvyw8\"}, // Vault\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0pUz3WIhib9q7QPy\"}, // Resilient\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.2VNR2iaZ8GrXZ5Sx\"}, // Mind Timer\n        {type:\"skill\",skill:\"Demolition\",  mod:20},\n        {type:\"skill\",skill:\"Camouflage\",  mod:10},\n        {type:\"skill\",skill:\"Investigation\",mod:20}\n      ]\n    },\n    \"Technician/Comms\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qNwmoK9nqxfRgOaG\"}, // Alien Tech\n        {type:\"prompt\", message:\"**Manual:** Choose One Enemy Language.\"}, // TODO: incorporate this into a prompt that will add a language item\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"skill\",skill:\"Command\",     mod:0},\n        {type:\"skill\",skill:\"Technology\",   mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.IVEx3UfnW5SzTGGP\"}, // Reliable Reputation\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.CAyM3Vmh45DelGeV\"}, // Quick Draw\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Wz6lFlw9ziPHIuWw\"}, // Peer\n        {type:\"skill\",skill:\"Command\",     mod:10},\n        {type:\"skill\",skill:\"Technology\",   mod:10},\n        {type:\"skill\",skill:\"Evasion\",      mod:0},\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.2VNR2iaZ8GrXZ5Sx\"}, // Mind Timer\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.3KMXf1vwMEE8zufr\"}, // Triangulation\n        {type:\"skill\",skill:\"Investigation\",mod:10},\n        {type:\"skill\",skill:\"Technology\",   mod:20},\n        {type:\"skill\",skill:\"Evasion\",      mod:10}\n      ]\n    },\n    \"Point Man\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.92Y5gNJxXwd3EBPB\"}, // Fast Foot\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0pUz3WIhib9q7QPy\"}, // Resilient\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"skill\",skill:\"Athletics\",   mod:0},\n        {type:\"skill\",skill:\"Survival\",    mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.vN7OBvWX0zWIlCk9\"}, // Adept Marksman\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.SzbYbWPcUeP7uoLl\"}, // Eagle Eye\n        {type:\"skill\",skill:\"Investigation\", mod:10}, // ability as skill\n        {type:\"skill\",skill:\"Athletics\",   mod:10},\n        {type:\"skill\",skill:\"Survival\",    mod:10},\n        {type:\"skill\",skill:\"Evasion\",      mod:0},\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.WFfHiWzmaJuB031m\"}, // Focused Warrior\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Ecxe55FHG2dPbJWq\"}, // Mobile Fire\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.ZFYVOdZX28U8adJw\"}, // Snapshot\n        {type:\"skill\",skill:\"Camouflage\",  mod:0},\n        {type:\"skill\",skill:\"Athletics\",   mod:20},\n        {type:\"skill\",skill:\"Evasion\",      mod:10}\n      ]\n    },\n    \"Recon/Infiltration\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.SzbYbWPcUeP7uoLl\"}, // Eagle Eye\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.E3wwCLYxaFgcWbvh\"}, // Exceptional Hearing\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.XssXb6JETXmsJjfP\"}, // Always Ready\n        {type:\"skill\",skill:\"Camouflage\",  mod:0},\n        {type:\"skill\",skill:\"Athletics\",   mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qdwUHz1TMAe4z5kn\"}, // Clear Target\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.E3wwCLYxaFgcWbvh\"}, // Disarm\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"skill\",skill:\"Camouflage\",  mod:10},\n        {type:\"skill\",skill:\"Athletics\",   mod:10},\n        {type:\"skill\",skill:\"Cryptography\",mod:0},\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Ecxe55FHG2dPbJWq\"}, // Mobile Fire\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0pUz3WIhib9q7QPy\"}, // Outstanding Olfactory\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0pUz3WIhib9q7QPy\"}, // Resilient\n        {type:\"skill\",skill:\"Camouflage\",  mod:20},\n        {type:\"skill\",skill:\"Athletics\",   mod:20},\n        {type:\"skill\",skill:\"Navigation\",  mod:0}\n      ]\n    },\n    \"Resource/Support\": {\n      \"Normal\":[\n        {type:\"support\",mod:2}, // Support Points +2\n        {type:\"prompt\", message:\"**Manual:** Apply Chosen Education +5.\"}, // TODO: incorporate this into a prompt that will add an education item\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.CAyM3Vmh45DelGeV\"}, // Quick Draw\n        {type:\"skill\",skill:\"Technology\",  mod:0},\n        {type:\"skill\",skill:\"Security\",    mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Yfeh2DUkDLZEpDYN\"}, // One Eye Open\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Wz6lFlw9ziPHIuWw\"}, // Peer\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.SzbYbWPcUeP7uoLl\"},   // Eagle Eye\n        {type:\"skill\",skill:\"Interrogation\",mod:0},\n        {type:\"skill\",skill:\"Navigation\",  mod:0},\n        {type:\"skill\",skill:\"Security\",    mod:10},\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.XssXb6JETXmsJjfP\"}, // Always Ready\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.BntBrX4BALzpaJOP\"}, // Inspiration\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qNwmoK9nqxfRgOaG\"},  // Alien Tech\n        {type:\"skill\",skill:\"Technology\",  mod:10},\n        {type:\"skill\",skill:\"Cryptography\",  mod:0},\n        {type:\"skill\",skill:\"Appeal\",  mod:0}\n      ]\n    },\n    \"Duelist\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.VPu3FMZlHurMqMsR\"}, // Akimbo\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.HTCXq6GoHltcSKoC\"}, // Denial\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"skill\",skill:\"Evasion\",     mod:0},\n        {type:\"skill\",skill:\"Survival\",    mod:0},\n        {type:\"skill\",skill:\"Athletics\",   mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.CAyM3Vmh45DelGeV\"}, // Quick Draw\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.GVhZ5ujoVyIDV6rv\"}, // Rush\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qdwUHz1TMAe4z5kn\"}, // Clear Target\n        {type:\"skill\",skill:\"Evasion\",     mod:10},\n        {type:\"skill\",skill:\"Athletics\",   mod:10},\n        {type:\"skill\",skill:\"Stunting\",    mod:0}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.92Y5gNJxXwd3EBPB\"}, // Swift Shot\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.92Y5gNJxXwd3EBPB\"}, // Fast Foot\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Frcf7nvSMFMLFyS3\"}, // Evasive Maneuvers\n        {type:\"skill\",skill:\"Evasion\",     mod:20},\n        {type:\"skill\",skill:\"Athletics\",   mod:20},\n        {type:\"skill\",skill:\"Stunting\",    mod:10}\n      ]\n    },\n    \"Command\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.fLU5y1uoix44oVqA\"}, // Order of Things\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.iy2n5KwgQaCu1pcr\"}, // Under Control\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.IVEx3UfnW5SzTGGP\"}, // Reliable Reputation\n        {type:\"skill\",skill:\"Command\",     mod:0},\n        {type:\"skill\",skill:\"Appeal\",      mod:0},\n        {type:\"skill\",skill:\"Investigation\",mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.BntBrX4BALzpaJOP\"}, // Inspiration\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"skill\",skill:\"Command\",     mod:10},\n        {type:\"skill\",skill:\"Appeal\",      mod:10},\n        {type:\"skill\",skill:\"Intimidation\",mod:0}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.2VNR2iaZ8GrXZ5Sx\"}, // Mind Timer\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.4EK3EpBemumZt3qb\"}, // Peer\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.4EK3EpBemumZt3qb\"}, // Valorous\n        {type:\"skill\",skill:\"Command\",     mod:20},\n        {type:\"skill\",skill:\"Intimidation\",mod:10},\n        {type:\"skill\",skill:\"Investigation\",mod:10}\n      ]\n    },\n    \"Logistics\": {\n      \"Normal\":[\n        {type:\"prompt\", message:\"**Manual:** Apply Chosen Education +5.\"}, // TODO: incorporate this into a prompt that will add an education item\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.E3wwCLYxaFgcWbvh\"}, // Exceptional Hearing\n        {type:\"prompt\", message:\"**Manual:** One Enemy Language\"}, // TODO: incorporate this into a prompt that will add a language item\n        {type:\"skill\",skill:\"Cryptography\",mod:0},\n        {type:\"skill\",skill:\"Security\",    mod:0},\n        {type:\"skill\",skill:\"Technology\",  mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.5IndLMbdYr1QLYsg\"}, // Battle Mind\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qNwmoK9nqxfRgOaG\"}, // Alien Tech\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.3KMXf1vwMEE8zufr\"}, // Triangulation\n        {type:\"skill\",skill:\"Cryptography\",mod:10},\n        {type:\"skill\",skill:\"Security\",    mod:10},\n        {type:\"skill\",skill:\"Technology\",  mod:10}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.VF0hzdmqI0NUvyw8\"}, // Vault\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.QeSIq7XoazHnKH6o\"},    // Wheelman\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.iy2n5KwgQaCu1pcr\"}, // Under Control\n        {type:\"skill\",skill:\"Cryptography\",mod:20},\n        {type:\"skill\",skill:\"Security\",    mod:20},\n        {type:\"skill\",skill:\"Technology\",  mod:20}\n      ]\n    },\n    \"Medical Physician\": {\n      \"Normal\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.K8bPGrN0DTWujQDy\"}, // Cynical\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.HIWb77it2BEoVOqq\"}, // Stabilization\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.iy2n5KwgQaCu1pcr\"}, // Under Control\n        {type:\"skill\",skill:\"Investigation\",mod:0},\n        {type:\"skill\",skill:\"Medication\",   mod:0},\n        {type:\"skill\",skill:\"Technology\",   mod:0}\n      ],\n      \"Heroic\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.0OOIRNcRqKw1n5HS\"},  // Blur\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.JwifQnFCCkRGDBvO\"}, // Gather Senses\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.qvUsoMk7EMuCHurE\"}, // Medical Insight\n        {type:\"skill\",skill:\"Medication\",   mod:10},\n        {type:\"skill\",skill:\"Investigation\",mod:10},\n        {type:\"skill\",skill:\"Technology\",   mod:10}\n      ],\n      \"Legendary\":[\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.Krt2F1WezBNvMi9Z\"}, // Medical Prowess\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.bjnFpmiVJe1WbDt4\"}, // Field Medic -- I know this isn't what the book says, but the Medical Physician has \"Stabilization\" twice in the book, so I added Field Medic here as a choice.\n        {type:\"item\",uuid: \"Compendium.mythic.abilities.Item.l4fgPRwp4b8gNynd\"}, // Second Chance\n        {type:\"skill\",skill:\"Medication\",   mod:20},\n        {type:\"skill\",skill:\"Technology\",   mod:20},\n        {type:\"skill\",skill:\"Evasion\",      mod:0}\n      ]\n    }\n  };\n\n  // ── 5) Build cumulative tiers (Easy → none)\n  const cumulative = [];\n  if (bestiaryLevel !== \"Easy\")          cumulative.push(\"Normal\");\n  if ([\"Heroic\",\"Legendary\"].includes(bestiaryLevel)) cumulative.push(\"Heroic\");\n  if (bestiaryLevel === \"Legendary\")     cumulative.push(\"Legendary\");\n  const levelsToApply = [...new Set(cumulative)];\n\n  // ── 6) Map display names → system.skills keys\n  const skillKeyMap = {\n    // Core\n    \"Appeal\":             \"appeal\",\n    \"Athletics\":          \"athletics\",\n    \"Camouflage\":         \"camouflage\",\n    \"Command\":            \"command\",\n    \"Cryptography\":       \"cryptography\",\n    \"Deception\":          \"deception\",\n    \"Demolition\":         \"demolition\",\n    \"Evasion\":            \"evasion\",\n    \"Gambling\":           \"gambling\",\n    \"Interrogation\":      \"interrogation\",\n    \"Intimidation\":       \"intimidation\",\n    \"Investigation\":      \"investigation\",\n    \"Negotiation\":        \"negotiation\",\n    \"Security\":           \"security\",\n    \"Stunting\":           \"stunting\",\n    \"Survival\":           \"survival\",\n    // Pilot\n    \"Pilot (Air)\":        \"pilotAir\",\n    \"Pilot (Ground)\":     \"pilotGround\",\n    \"Pilot (Space)\":      \"pilotSpace\",\n    // Navigation\n    \"Navigation (Ground/Air)\": \"navGroundAir\",\n    \"Navigation (Space)\": \"navSpace\",\n    // Tech\n    \"Tech (Human)\":       \"techHuman\",\n    \"Tech (Covenant)\":    \"techCovenant\",\n    \"Tech (Forerunner)\":  \"techForerunner\",\n    // Medic\n    \"Medic (Human)\":      \"medHuman\",\n    \"Medic (Covenant)\":   \"medCovenant\",\n    \"Medic (Xenophile)\":  \"medXenophile\"\n  };\n\n  // ── 7) Apply to each selected token\n  for (let token of canvas.tokens.controlled) {\n    const actor = token.actor;\n\n// ── A) Remove any existing Spec-Kit abilities & reset those skill trainings ──\n// (1) Build a list of all the kit-provided item names\nconst kitItemNames = Object.values(specializationData)\n  .flatMap(kit => Object.values(kit)\n    .flatMap(entries => entries\n      .filter(e => e.type === \"item\")\n      .map(e => e.name)\n    )\n  );\n\n// (2) Delete any matching items on the actor\nconst toDelete = actor.items.filter(i => kitItemNames.includes(i.name));\nif ( toDelete.length ) {\n  await actor.deleteEmbeddedDocuments(\"Item\", toDelete.map(i => i.id));\n}\n\n// (3) Reset all Spec-Kit skills back to “none”\nconst resetData = {};\nfor ( let key of Object.values(skillKeyMap) ) {\n  if ( actor.system.skills?.[key] ) {\n    resetData[`system.skills.${key}.training.tier`] = \"none\";\n  }\n}\nif ( Object.keys(resetData).length ) {\n  await actor.update(resetData);\n}\n    \n// B) Set the Bestiary‐Level → difficulty.tier and then top‐off Wounds ──\n// Map your levels to numeric tiers\nconst tierMap = { Easy: 0, Normal: 1, Heroic: 2, Legendary: 3 };\nawait actor.update({\n  \"system.difficulty.tier\": tierMap[bestiaryLevel].toString()\n});\n\n// Now max out Wounds.\nconst maxW = actor.system.wounds.max;   \nawait actor.update({ \"system.wounds.value\": maxW });\n\n    // B) update the sheet’s specialization field\n    await actor.update({ \"system.specialization\": selectedSpec });\n    ui.notifications.info(`Set specialization → ${selectedSpec}`);\n\n\n\n\n\n    // C) for each tier, loop entries\n    for (let lvl of levelsToApply) {\n      const entries = specializationData[selectedSpec]?.[lvl] || [];\n      for (let entry of entries) {\n\n        // — Items/Abilities\n        if (entry.type === \"item\") {\n          // Pull directly from the compendium by UUID\n          const compendiumItem = await fromUuid(entry.uuid);\n          if (!compendiumItem) {\n            return ui.notifications.warn(`Could not find compendium entry ${entry.uuid}`);\n          }\n          // Create a copy of it on the actor\n          await actor.createEmbeddedDocuments(\"Item\", [ compendiumItem.toObject() ]);\n          //ui.notifications.info(`Added item '${entry.name}' to ${actor.name}.`);\n        }\n\n        // — Skill trainings\n        else if (entry.type === \"skill\") {\n          // build displayName (apply any variant)\n          let displayName = entry.skill;\n          if (entry.skill === \"Pilot\"     && pilotVariant) displayName = `Pilot (${pilotVariant})`;\n          if (entry.skill === \"Navigation\"&& navVariant)   displayName = `Navigation (${navVariant})`;\n          if (entry.skill === \"Technology\"&& techVariant)  displayName = `Tech (${techVariant})`;\n          if (entry.skill === \"Medication\"&& medVariant)   displayName = `Medic (${medVariant})`;\n\n          // find the precise key\n          const skillKey = skillKeyMap[displayName]\n                         || displayName.toLowerCase().replace(/[^a-z0-9]/g,\"\");\n          if (!actor.system.skills?.[skillKey]) {\n            ui.notifications.warn(`Skill '${displayName}' not found on ${actor.name}.`);\n            console.warn(`Missing skillKey '${skillKey}' for '${displayName}'`, Object.keys(actor.system.skills));\n            continue;\n          }\n\n          // decide tier\n          let newTier = \"trained\";\n          if (entry.mod === 10)    newTier = \"plus10\";\n          else if (entry.mod === 20) newTier = \"plus20\";\n\n          // apply to training.tier\n          await actor.update({ [`system.skills.${skillKey}.training.tier`]: newTier });\n          //ui.notifications.info(`Set ${displayName} → ${newTier} on ${actor.name}.`);\n        }\n\n        // — Support points\n        else if (entry.type === \"support\") {\n          const current = actor.system.supportPoints?.other || 0;\n          await actor.update({ \"system.supportPoints.other\": current + entry.mod });\n          //ui.notifications.info(`Added ${entry.mod} support points to ${actor.name}.`);\n        }\n\n        // — Manual prompts\n        else if (entry.type === \"prompt\") {\n          await new Promise(res => {\n            new Dialog({\n              title: \"Manual Step Required\",\n              content: `<p>${entry.message}</p>`,\n              buttons: { ok: { label: \"OK\", callback: () => res(true) }},\n              default: \"ok\"\n            }).render(true);\n          });\n        }\n      }\n    }\n  }\n\n})();",
  "img": "Accord/Icons/Spec%20Kit%20Macro.png",
  "author": "lyNMAkEjAC9WtuDL",
  "scope": "global",
  "folder": null,
  "flags": {
    "exportSource": {
      "world": "wilkes-halo-mythic",
      "system": "mythic",
      "coreVersion": "12.343",
      "systemVersion": "0.4.0"
    }
  },
  "_stats": {
    "coreVersion": "12.343",
    "systemId": "mythic",
    "systemVersion": "0.4.0",
    "createdTime": 1751228633798,
    "modifiedTime": 1751802419621,
    "lastModifiedBy": "lyNMAkEjAC9WtuDL"
  }
}